FROM debian:stable-slim as builder
RUN apt-get update && apt-get install -y build-essential \ 
    gnutls-dev pkg-config libpcre3-dev git vim libdb-dev  sudo
 
# Comment out if you are just building a binary
RUN apt-get install -y afl++ clang

RUN adduser --disabled-password exim


WORKDIR /build
COPY . .

# Choose only one of Makefile.afl or Makefile
# afl build separate because it seems default build does not use CC
RUN ./build.sh Makefile.afl
#RUN ./build.sh Makefile

EXPOSE 25
CMD ["/usr/exim/bin/exim", "-bs", "-v"]
